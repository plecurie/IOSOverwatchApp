#!/usr/bin/env node
'use strict';

var _assign = require('babel-runtime/core-js/object/assign');

var _assign2 = _interopRequireDefault(_assign);

var _dotenv = require('dotenv');

var _dotenv2 = _interopRequireDefault(_dotenv);

var _commander = require('commander');

var _commander2 = _interopRequireDefault(_commander);

var _chalk = require('chalk');

var _chalk2 = _interopRequireDefault(_chalk);

var _updateNotifier = require('update-notifier');

var _updateNotifier2 = _interopRequireDefault(_updateNotifier);

var _package = require('../package.json');

var _package2 = _interopRequireDefault(_package);

var _default = require('./default.json');

var _default2 = _interopRequireDefault(_default);

var _path = require('path');

var _index = require('./cmd/index');

var cmd = _interopRequireWildcard(_index);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/* eslint no-console:0 import/no-unresolved:0 */

(0, _updateNotifier2.default)({ pkg: _package2.default }).notify();

// Banner.
var banner = '\n▼ ' + _package2.default.name + ' - v' + _package2.default.version + '\n' + _package2.default.homepage + '\n';
console.log(_chalk2.default.cyan(banner));

// Load dotenv.
_dotenv2.default.config({ silent: true });

// Parse CLI args.
_commander2.default.version(_package2.default.version).usage('entrypoint.js [options]').option('-p, --port [n]', 'Port to listen on', process.env.PORT).option('-H, --host [value]', 'Host to listen on', process.env.HOST).option('-D, --docs [value]', 'Generate Docs from folder', _default2.default.docs.folder).option('-L, --lint', 'Lint code with ESLint').option('-n, --no-babel', 'Skip Babel transformation').option('-C, --config [value]', 'Configuration file').parse(process.argv);

// Parse entrypoint file.
var file = _commander2.default.args.pop();
if (!file) {
  try {
    var packageJson = require((0, _path.resolve)( // eslint-disable-line global-require
    process.cwd(), 'package.json'));
    file = packageJson.main;
  } catch (e) {
    console.error(_chalk2.default.red(e));
    process.exit(1);
  }
}

if (!file) {
  console.error(_chalk2.default.red('Error! Please supply a file.'));
  process.exit(1);
}

if (file[0] !== '/') {
  file = (0, _path.resolve)(process.cwd(), file);
}

// Update config object if custom config file is provided.
if (_commander2.default.config) {
  try {
    // Load external config file.
    var customConfig = require((0, _path.resolve)( // eslint-disable-line global-require
    process.cwd(), _commander2.default.config));

    // Extend config object.
    (0, _assign2.default)(_default2.default, customConfig);

    console.log(_chalk2.default.blue('▼ Loading configuration: '), _chalk2.default.white(_commander2.default.config));
  } catch (err) {
    console.error(_chalk2.default.red(err));
    process.exit(1);
  }
}

// Skip babel transpilation if flag set.
if (!_commander2.default.noBabel) {
  try {
    cmd.transpile();
    console.log(_chalk2.default.blue('▼ Babel transpiled. Preset: ES2015'));
  } catch (err) {
    console.error(_chalk2.default.red(err));
    process.exit(1);
  }
}

// Generate docs flag.
if (_commander2.default.docs) {
  try {
    cmd.docs(_commander2.default.docs, _default2.default.docs);
    console.log(_chalk2.default.blue('▼ Docs generated.'), _chalk2.default.white('http://' + _default2.default.app.host + ':' + _default2.default.app.port + '/docs'));
  } catch (err) {
    console.error(_chalk2.default.red(err));
    process.exit(1);
  }
}

if (_commander2.default.lint) {
  try {
    console.log(_chalk2.default.blue('▼ Linting code.'));
    cmd.lint(_default2.default.lint);
  } catch (err) {
    console.error(_chalk2.default.red(err));
    process.exit(1);
  }
}

// Host and port flags take precedence.
_default2.default.app.host = _commander2.default.host || _default2.default.app.host;
_default2.default.app.port = _commander2.default.port || _default2.default.app.port;

// Start server.
cmd.server(file, _default2.default, function (err) {
  if (err) {
    console.error(_chalk2.default.red(err));
  }
  var _config$app = _default2.default.app;
  var host = _config$app.host;
  var port = _config$app.port;

  console.log(_chalk2.default.green('▼ Ready! Listening on:', _chalk2.default.white('http://' + host + ':' + port)));
});
//# sourceMappingURL=data:application/json;base64,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QU0sS0FBTixDQUFZLHdCQUFaLEVBQXNDLGdCQUFNLEtBQU4sYUFBc0IsSUFBdEIsU0FBOEIsSUFBOUIsQ0FBdEMsQ0FBWjtBQUNELENBTkQiLCJmaWxlIjoic3J2LmpzIiwic291cmNlc0NvbnRlbnQiOlsiXG5cbi8qIGVzbGludCBuby1jb25zb2xlOjAgaW1wb3J0L25vLXVucmVzb2x2ZWQ6MCAqL1xuXG5pbXBvcnQgZG90ZW52IGZyb20gJ2RvdGVudic7XG5pbXBvcnQgcHJvZ3JhbSBmcm9tICdjb21tYW5kZXInO1xuaW1wb3J0IGNoYWxrIGZyb20gJ2NoYWxrJztcbmltcG9ydCB1cGRhdGVOb3RpZmllciBmcm9tICd1cGRhdGUtbm90aWZpZXInO1xuaW1wb3J0IHBrZyBmcm9tICcuLi9wYWNrYWdlLmpzb24nO1xuaW1wb3J0IGNvbmZpZyBmcm9tICcuL2RlZmF1bHQuanNvbic7XG5pbXBvcnQgeyByZXNvbHZlIH0gZnJvbSAncGF0aCc7XG5cbmltcG9ydCAqIGFzIGNtZCBmcm9tICcuL2NtZC9pbmRleCc7XG5cbnVwZGF0ZU5vdGlmaWVyKHsgcGtnIH0pLm5vdGlmeSgpO1xuXG4vLyBCYW5uZXIuXG5jb25zdCBiYW5uZXIgPSBgXG7ilrwgJHtwa2cubmFtZX0gLSB2JHtwa2cudmVyc2lvbn1cbiR7cGtnLmhvbWVwYWdlfVxuYDtcbmNvbnNvbGUubG9nKGNoYWxrLmN5YW4oYmFubmVyKSk7XG5cbi8vIExvYWQgZG90ZW52LlxuZG90ZW52LmNvbmZpZyh7IHNpbGVudDogdHJ1ZSB9KTtcblxuLy8gUGFyc2UgQ0xJIGFyZ3MuXG5wcm9ncmFtXG4gIC52ZXJzaW9uKHBrZy52ZXJzaW9uKVxuICAudXNhZ2UoJ2VudHJ5cG9pbnQuanMgW29wdGlvbnNdJylcbiAgLm9wdGlvbignLXAsIC0tcG9ydCBbbl0nLCAnUG9ydCB0byBsaXN0ZW4gb24nLCBwcm9jZXNzLmVudi5QT1JUKVxuICAub3B0aW9uKCctSCwgLS1ob3N0IFt2YWx1ZV0nLCAnSG9zdCB0byBsaXN0ZW4gb24nLCBwcm9jZXNzLmVudi5IT1NUKVxuICAub3B0aW9uKCctRCwgLS1kb2NzIFt2YWx1ZV0nLCAnR2VuZXJhdGUgRG9jcyBmcm9tIGZvbGRlcicsIGNvbmZpZy5kb2NzLmZvbGRlcilcbiAgLm9wdGlvbignLUwsIC0tbGludCcsICdMaW50IGNvZGUgd2l0aCBFU0xpbnQnKVxuICAub3B0aW9uKCctbiwgLS1uby1iYWJlbCcsICdTa2lwIEJhYmVsIHRyYW5zZm9ybWF0aW9uJylcbiAgLm9wdGlvbignLUMsIC0tY29uZmlnIFt2YWx1ZV0nLCAnQ29uZmlndXJhdGlvbiBmaWxlJylcbiAgLnBhcnNlKHByb2Nlc3MuYXJndik7XG5cblxuLy8gUGFyc2UgZW50cnlwb2ludCBmaWxlLlxubGV0IGZpbGUgPSBwcm9ncmFtLmFyZ3MucG9wKCk7XG5pZiAoIWZpbGUpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBwYWNrYWdlSnNvbiA9IHJlcXVpcmUocmVzb2x2ZSggIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgZ2xvYmFsLXJlcXVpcmVcbiAgICAgIHByb2Nlc3MuY3dkKCksICdwYWNrYWdlLmpzb24nKSk7XG4gICAgZmlsZSA9IHBhY2thZ2VKc29uLm1haW47XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBjb25zb2xlLmVycm9yKGNoYWxrLnJlZChlKSk7XG4gICAgcHJvY2Vzcy5leGl0KDEpO1xuICB9XG59XG5cbmlmICghZmlsZSkge1xuICBjb25zb2xlLmVycm9yKGNoYWxrLnJlZCgnRXJyb3IhIFBsZWFzZSBzdXBwbHkgYSBmaWxlLicpKTtcbiAgcHJvY2Vzcy5leGl0KDEpO1xufVxuXG5pZiAoZmlsZVswXSAhPT0gJy8nKSB7XG4gIGZpbGUgPSByZXNvbHZlKHByb2Nlc3MuY3dkKCksIGZpbGUpO1xufVxuXG4vLyBVcGRhdGUgY29uZmlnIG9iamVjdCBpZiBjdXN0b20gY29uZmlnIGZpbGUgaXMgcHJvdmlkZWQuXG5pZiAocHJvZ3JhbS5jb25maWcpIHtcbiAgdHJ5IHtcbiAgICAvLyBMb2FkIGV4dGVybmFsIGNvbmZpZyBmaWxlLlxuICAgIGNvbnN0IGN1c3RvbUNvbmZpZyA9IHJlcXVpcmUocmVzb2x2ZSggIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgZ2xvYmFsLXJlcXVpcmVcbiAgICAgIHByb2Nlc3MuY3dkKCksIHByb2dyYW0uY29uZmlnKSk7XG5cbiAgICAvLyBFeHRlbmQgY29uZmlnIG9iamVjdC5cbiAgICBPYmplY3QuYXNzaWduKGNvbmZpZywgY3VzdG9tQ29uZmlnKTtcblxuICAgIGNvbnNvbGUubG9nKGNoYWxrLmJsdWUoJ+KWvCBMb2FkaW5nIGNvbmZpZ3VyYXRpb246ICcpLCBjaGFsay53aGl0ZShwcm9ncmFtLmNvbmZpZykpO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBjb25zb2xlLmVycm9yKGNoYWxrLnJlZChlcnIpKTtcbiAgICBwcm9jZXNzLmV4aXQoMSk7XG4gIH1cbn1cblxuLy8gU2tpcCBiYWJlbCB0cmFuc3BpbGF0aW9uIGlmIGZsYWcgc2V0LlxuaWYgKCFwcm9ncmFtLm5vQmFiZWwpIHtcbiAgdHJ5IHtcbiAgICBjbWQudHJhbnNwaWxlKCk7XG4gICAgY29uc29sZS5sb2coY2hhbGsuYmx1ZSgn4pa8IEJhYmVsIHRyYW5zcGlsZWQuIFByZXNldDogRVMyMDE1JykpO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBjb25zb2xlLmVycm9yKGNoYWxrLnJlZChlcnIpKTtcbiAgICBwcm9jZXNzLmV4aXQoMSk7XG4gIH1cbn1cblxuLy8gR2VuZXJhdGUgZG9jcyBmbGFnLlxuaWYgKHByb2dyYW0uZG9jcykge1xuICB0cnkge1xuICAgIGNtZC5kb2NzKHByb2dyYW0uZG9jcywgY29uZmlnLmRvY3MpO1xuICAgIGNvbnNvbGUubG9nKGNoYWxrLmJsdWUoJ+KWvCBEb2NzIGdlbmVyYXRlZC4nKSwgY2hhbGsud2hpdGUoYGh0dHA6Ly8ke2NvbmZpZy5hcHAuaG9zdH06JHtjb25maWcuYXBwLnBvcnR9L2RvY3NgKSk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGNvbnNvbGUuZXJyb3IoY2hhbGsucmVkKGVycikpO1xuICAgIHByb2Nlc3MuZXhpdCgxKTtcbiAgfVxufVxuXG5pZiAocHJvZ3JhbS5saW50KSB7XG4gIHRyeSB7XG4gICAgY29uc29sZS5sb2coY2hhbGsuYmx1ZSgn4pa8IExpbnRpbmcgY29kZS4nKSk7XG4gICAgY21kLmxpbnQoY29uZmlnLmxpbnQpO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBjb25zb2xlLmVycm9yKGNoYWxrLnJlZChlcnIpKTtcbiAgICBwcm9jZXNzLmV4aXQoMSk7XG4gIH1cbn1cblxuLy8gSG9zdCBhbmQgcG9ydCBmbGFncyB0YWtlIHByZWNlZGVuY2UuXG5jb25maWcuYXBwLmhvc3QgPSBwcm9ncmFtLmhvc3QgfHwgY29uZmlnLmFwcC5ob3N0O1xuY29uZmlnLmFwcC5wb3J0ID0gcHJvZ3JhbS5wb3J0IHx8IGNvbmZpZy5hcHAucG9ydDtcblxuLy8gU3RhcnQgc2VydmVyLlxuY21kLnNlcnZlcihmaWxlLCBjb25maWcsIChlcnIpID0+IHtcbiAgaWYgKGVycikge1xuICAgIGNvbnNvbGUuZXJyb3IoY2hhbGsucmVkKGVycikpO1xuICB9XG4gIGNvbnN0IHsgaG9zdCwgcG9ydCB9ID0gY29uZmlnLmFwcDtcbiAgY29uc29sZS5sb2coY2hhbGsuZ3JlZW4oJ+KWvCBSZWFkeSEgTGlzdGVuaW5nIG9uOicsIGNoYWxrLndoaXRlKGBodHRwOi8vJHtob3N0fToke3BvcnR9YCkpKTtcbn0pO1xuIl19